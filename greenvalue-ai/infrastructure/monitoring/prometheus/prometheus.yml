# ============================================================
# GreenValue AI - Prometheus Configuration
# Layer 7: Observability & Monitoring
# ============================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  scrape_timeout: 10s

rule_files:
  - /etc/prometheus/alerting_rules.yml
  - /etc/prometheus/recording_rules.yml

scrape_configs:
  # --- Self Monitoring ---
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]
        labels:
          service: "prometheus"

  # --- Layer 3: NestJS Backend ---
  - job_name: "greenvalue-backend"
    metrics_path: /api/v1/metrics
    static_configs:
      - targets: ["greenvalue-be:3000"]
        labels:
          service: "backend"
          layer: "3"

  # --- Layer 4: AI Engine (FastAPI) ---
  - job_name: "greenvalue-ai"
    metrics_path: /metrics
    static_configs:
      - targets: ["greenvalue-ai:9090"]
        labels:
          service: "ai-engine"
          layer: "4"

  # --- Node Exporter (System Metrics) ---
  - job_name: "node-exporter"
    static_configs:
      - targets: ["node-exporter:9100"]
        labels:
          service: "node-exporter"

  # --- cAdvisor (Container Metrics) ---
  - job_name: "cadvisor"
    static_configs:
      - targets: ["cadvisor:8080"]
        labels:
          service: "cadvisor"

  # --- Redis ---
  - job_name: "redis"
    static_configs:
      - targets: ["redis:6379"]
        labels:
          service: "redis"
